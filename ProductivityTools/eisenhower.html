<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eisenhower Matrix</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; }
        h1, h3 { margin-top: 0; margin-bottom: 5px; }
        .container { max-width: 1000px; margin: 0 auto; padding: 5px; }
        .section { margin-bottom: 10px; padding: 10px; border: 1px solid #eee; position: relative; }
        .control-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .progress-bar-container { height: 12px; background-color: #f0f0f0; border: 1px solid #ccc; margin-top: 10px; border-radius: 3px; }
        .progress-bar-fill { height: 100%; background-color: #000000; transition: width 0.3s ease-in-out; border-radius: 3px; }
        button { padding: 8px 12px; border: 1px solid #ccc; background-color: #f9f9f9; cursor: pointer; }
        button:hover { background-color: #e9e9e9; }
        input[type="text"] { padding: 8px 12px; border: 1px solid #ccc; }
        [contenteditable]:focus, input:focus { outline: 2px solid black; }
        ul { list-style: none; padding-left: 0; }
        li { margin-bottom: 6px; }
        .grid-2x2 { display: grid; grid-template-columns: repeat(2, 1fr); grid-auto-rows: auto; gap: 8px; }
        .muted { color: #666; font-size: 12px; }
        .quad-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .task-item { display: flex; align-items: center; gap: 6px; }
        .task-text { flex: 1; }
        /* Match checklist + / − compact buttons */
        .checkbox-style-button {
            all: unset;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 12px;
            height: 12px;
            border: 1px solid #888;
            background-color: #fff;
            cursor: pointer;
            font-size: 11px;
            line-height: 1;
            margin-right: 3px;
            color: #333;
            border-radius: 3px;
        }
        .checkbox-style-button:hover { background-color: #f0f0f0; }
    </style>
    <link rel="icon" href="data:," />
    <meta name="color-scheme" content="light" />
    <script src="storage.js"></script>
</head>
<body>
    <div class="container" id="main-container">
        <div class="section">
            <div class="control-bar">
                <div style="flex:1">
                    <div><span id="overall-progress-text">0/0 completed</span></div>
                    <div class="progress-bar-container">
                        <div id="overall-progress-bar" class="progress-bar-fill"></div>
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap:6px; margin-left:10px">
                    <input id="projectTitleInput" type="text" value="Eisenhower Matrix" />
                    <span id="auto-save-indicator" style="font-size: 12px; color: #666; opacity: 0; transition: opacity 0.3s;">Auto-saved</span>
                </div>
            </div>
        </div>

        <div class="grid-2x2" id="matrix-grid">
            <!-- Quadrants render here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const initialData = {
                title: 'Eisenhower Matrix',
                quadrants: [
                    { id: 'q1', title: 'Do (Urgent & Important)', tasks: [
                        { id: 'q1-t1', text: 'Handle critical bug', checked: false },
                        { id: 'q1-t2', text: 'Prepare for imminent deadline', checked: false }
                    ]},
                    { id: 'q2', title: 'Plan (Not Urgent & Important)', tasks: [
                        { id: 'q2-t1', text: 'Strategic planning', checked: false },
                        { id: 'q2-t2', text: 'Skill development', checked: false }
                    ]},
                    { id: 'q3', title: 'Delegate (Urgent & Not Important)', tasks: [
                        { id: 'q3-t1', text: 'Respond to some requests', checked: false }
                    ]},
                    { id: 'q4', title: 'Eliminate (Not Urgent & Not Important)', tasks: [
                        { id: 'q4-t1', text: 'Unproductive browsing', checked: false }
                    ]}
                ]
            };

            // Load data from storage or use initial data
            let data = window.productivityStorage.loadAppData('eisenhower', initialData);
            if (!data) data = JSON.parse(JSON.stringify(initialData));

            const grid = document.getElementById('matrix-grid');
            const projectTitleInput = document.getElementById('projectTitleInput');
            const overallProgressText = document.getElementById('overall-progress-text');
            const overallProgressBar = document.getElementById('overall-progress-bar');

            function render() {
                grid.innerHTML = '';
                data.quadrants.forEach(q => {
                    const section = document.createElement('div');
                    section.className = 'section';
                    section.id = q.id;
                    section.innerHTML = `
                        <div class="quad-header">
                            <h3 contenteditable="true" data-type="quadrant-title" data-qid="${q.id}">${q.title}</h3>
                            <button data-action="add-task" data-qid="${q.id}" class="checkbox-style-button">+</button>
                        </div>
                        <div class="progress-bar-container">
                            <div id="${q.id}-progress" class="progress-bar-fill"></div>
                        </div>
                        <ul class="task-list">
                            ${q.tasks.map(t => `
                                <li>
                                    <div class="task-item">
                                        <button data-action="delete-task" data-qid="${q.id}" data-tid="${t.id}" class="checkbox-style-button">−</button>
                                        <input type="checkbox" id="${t.id}" data-type="task-checkbox" data-qid="${q.id}" ${t.checked ? 'checked' : ''} />
                                        <div class="task-text" contenteditable="true" data-type="task-text" data-qid="${q.id}" data-tid="${t.id}">${t.text}</div>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    grid.appendChild(section);
                });
                updateAllProgress();
            }

            function updateAllProgress() {
                // per quadrant
                data.quadrants.forEach(q => {
                    const el = document.getElementById(q.id);
                    if (!el) return;
                    const bar = document.getElementById(`${q.id}-progress`);
                    const total = q.tasks.length;
                    const done = q.tasks.filter(t => t.checked).length;
                    const pct = total > 0 ? (done / total) * 100 : 0;
                    if (bar) bar.style.width = `${pct}%`;
                });
                // overall
                const totals = data.quadrants.reduce((acc, q) => {
                    acc.total += q.tasks.length;
                    acc.done += q.tasks.filter(t => t.checked).length;
                    return acc;
                }, { total: 0, done: 0 });
                const overallPct = totals.total > 0 ? (totals.done / totals.total) * 100 : 0;
                overallProgressText.textContent = `${totals.done}/${totals.total} completed`;
                overallProgressBar.style.width = `${overallPct}%`;
            }

            function updateDataFromEditable(target) {
                const type = target.dataset.type;
                if (type === 'quadrant-title') {
                    const qid = target.dataset.qid;
                    const quad = data.quadrants.find(q => q.id === qid);
                    if (quad) quad.title = target.textContent;
                } else if (type === 'task-text') {
                    const qid = target.dataset.qid;
                    const tid = target.dataset.tid;
                    const quad = data.quadrants.find(q => q.id === qid);
                    if (!quad) return;
                    const task = quad.tasks.find(t => t.id === tid);
                    if (task) task.text = target.textContent;
                }
                // Auto-save after data changes
                window.productivityStorage.autoSave('eisenhower', data);
                showAutoSaveIndicator();
            }

            function showAutoSaveIndicator() {
                const indicator = document.getElementById('auto-save-indicator');
                indicator.style.opacity = '1';
                setTimeout(() => {
                    indicator.style.opacity = '0';
                }, 2000);
            }

            document.body.addEventListener('input', (e) => {
                const target = e.target;
                if (target.id === 'projectTitleInput') {
                    data.title = target.value;
                    // Auto-save after title change
                    window.productivityStorage.autoSave('eisenhower', data);
                    showAutoSaveIndicator();
                } else if (target.contentEditable === 'true') {
                    updateDataFromEditable(target);
                }
            });

            document.body.addEventListener('change', (e) => {
                const target = e.target;
                if (target.dataset.type === 'task-checkbox') {
                    const qid = target.dataset.qid;
                    const quad = data.quadrants.find(q => q.id === qid);
                    if (!quad) return;
                    const task = quad.tasks.find(t => t.id === target.id);
                    if (task) task.checked = !!target.checked;
                    updateAllProgress();
                    // Auto-save after checkbox change
                    window.productivityStorage.autoSave('eisenhower', data);
                    showAutoSaveIndicator();
                }
            });

            document.body.addEventListener('click', async (e) => {
                const target = e.target;
                const action = target.dataset.action;
                if (!action) return;
                switch(action) {
                    case 'add-task': {
                        const qid = target.dataset.qid;
                        const quad = data.quadrants.find(q => q.id === qid);
                        if (quad) {
                            quad.tasks.push({ id: `task-${Date.now()}`, text: 'New task', checked: false });
                            render();
                            // Auto-save after adding task
                            window.productivityStorage.autoSave('eisenhower', data);
                            showAutoSaveIndicator();
                        }
                        break;
                    }
                    case 'delete-task': {
                        const qid = target.dataset.qid;
                        const tid = target.dataset.tid;
                        const quad = data.quadrants.find(q => q.id === qid);
                        if (quad) {
                            quad.tasks = quad.tasks.filter(t => t.id !== tid);
                            render();
                            // Auto-save after deleting task
                            window.productivityStorage.autoSave('eisenhower', data);
                            showAutoSaveIndicator();
                        }
                        break;
                    }

                }
            });

            // Initial render
            projectTitleInput.value = data.title;
            render();
        });
    </script>
</body>
</html>



