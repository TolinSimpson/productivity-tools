<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Productivity Tools</title>
    <style>
        :root {
            --border: #eaeaea;
            --frame-height: 420px;
        }
        html, body { height: 100%; }
        body { margin: 0; font-family: sans-serif; display:flex; flex-direction:column; background:#fff; color:#000; }
        
        .header {
            background: #f8f9fa;
            border-bottom: 1px solid var(--border);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        
        .header-title {
            font-weight: 500;
            color: #333;
        }
        
        .header-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .header-button {
            padding: 4px 8px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            color: #666;
            text-decoration: none;
        }
        
        .header-button:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .storage-status {
            font-size: 12px;
            color: #666;
            margin-right: 8px;
        }
        
        .three-col { flex:1; display:flex; gap: 8px; padding: 8px; align-items: stretch; min-height: 0; }
        .col { flex: 1 1 0; display:flex; flex-direction:column; gap:8px; min-width: 260px; min-height: 0; }
        .frame-card { border: 1px solid var(--border); border-radius: 6px; overflow: hidden; display: flex; flex-direction: column; flex: 1 1 0; background:#fff; min-height: 0; }
        .frame-body { flex:1; min-height: 0; }
        .frame-body iframe { width: 100%; height: 100%; border: 0; display: block; }
    </style>
    <link rel="icon" href="data:," />
    <meta name="color-scheme" content="light" />
    <script src="storage.js"></script>
</head>
<body>
    
    <!-- Header with storage controls -->
    <div class="header">
        <div class="header-title">Productivity Tools</div>
        <div class="header-controls">
            <span class="storage-status" id="storage-status">Auto-saving enabled</span>
            <button class="header-button" onclick="exportAllData()">Export</button>
            <button class="header-button" onclick="importAllData()">Import</button>
            <button class="header-button" onclick="clearAllData()" style="color: #d32f2f;">Clear</button>
        </div>
    </div>
    
    <div class="three-col">
        <!-- First column: Eisenhower -->
        <div class="col">
            <div class="frame-card">
                <div class="frame-body">
                    <iframe id="frame-eisenhower" src="eisenhower.html"></iframe>
                </div>
            </div>
        </div>
        <!-- Second column: Pomodoro -->
        <div class="col">
            <div class="frame-card">
                <div class="frame-body">
                    <iframe id="frame-pomodoro" src="pomodoro.html"></iframe>
                </div>
            </div>
        </div>
        <!-- Third column: Checklist -->
        <div class="col">
            <div class="frame-card">
                <div class="frame-body">
                    <iframe id="frame-checklist" src="checklist.html"></iframe>
                </div>
            </div>
        </div>
    </div>



    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const defaultHeight = 420;
            document.documentElement.style.setProperty('--frame-height', defaultHeight + 'px');
            document.querySelectorAll('.frame-body').forEach(el => el.style.height = defaultHeight + 'px');
            
            // Initialize storage status
            updateStorageStatus();
        });

        // Storage Management Functions
        function updateStorageStatus() {
            const statusElement = document.getElementById('storage-status');
            const storage = window.productivityStorage;
            const info = storage.getStorageInfo();
            
            if (Object.keys(info).length === 0) {
                statusElement.textContent = 'No data saved';
            } else {
                const totalApps = Object.keys(info).length;
                statusElement.textContent = `${totalApps} app${totalApps > 1 ? 's' : ''} with saved data`;
            }
        }

        async function exportAllData() {
            try {
                const data = window.productivityStorage.exportAllData();
                const handle = await window.showSaveFilePicker({
                    suggestedName: 'productivity-tools-backup.json',
                    types: [{ description: 'JSON Files', accept: { 'application/json': ['.json'] } }]
                });
                const writable = await handle.createWritable();
                await writable.write(new Blob([data], { type: 'application/json' }));
                await writable.close();
                alert('All data exported successfully!');
            } catch (err) {
                if (err && err.name !== 'AbortError') {
                    console.error('Error exporting data:', err);
                    alert('Error exporting data. Please try again.');
                }
            }
        }

        async function importAllData() {
            try {
                const [handle] = await window.showOpenFilePicker({
                    types: [{ description: 'JSON Files', accept: { 'application/json': ['.json'] } }],
                    multiple: false
                });
                const file = await handle.getFile();
                const text = await file.text();
                const success = window.productivityStorage.importAllData(text);
                if (success) {
                    alert('Data imported successfully! Please refresh the page to see the changes.');
                    location.reload();
                } else {
                    alert('Error importing data. Please check the file format.');
                }
            } catch (err) {
                if (err && err.name !== 'AbortError') {
                    console.error('Error importing data:', err);
                    alert('Error importing data. Please try again.');
                }
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all saved data? This action cannot be undone.')) {
                window.productivityStorage.clearAllData();
                updateStorageStatus();
                alert('All data cleared successfully!');
            }
        }
    </script>
</body>
</html>



